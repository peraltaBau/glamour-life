{% extends "base.html" %}

{% block content %}
<div class="producto-detalle-container">
    <div class="breadcrumb">
        <a href="{{ url_for('departamentos_view') }}">Departamentos</a> ‚Üí
        <a href="{{ url_for('productos', depto_id=departamento.id) }}">{{ departamento.nombre }}</a> ‚Üí
        <span>{{ producto.nombre }}</span>
    </div>
    
    <div class="producto-detalle">
        <div class="producto-imagen-grande">
            <img src="{{ url_for('static', filename=producto.imagen_path) }}" 
                 alt="{{ producto.nombre }}"
                 onerror="this.src='{{ url_for('static', filename='img/placeholder.jpg') }}'">
        </div>
        
        <div class="producto-info-detalle">
            <div class="producto-categoria-badge">{{ producto.categoria }}</div>
            <h1 class="producto-marca-detalle">{{ producto.marca }}</h1>
            <h2 class="producto-nombre-detalle">{{ producto.nombre }}</h2>
            <p class="producto-precio-detalle">${{ "{:,.2f}".format(producto.precio) }}</p>
            
            <div class="producto-descripcion">
                <h3>Descripci√≥n</h3>
                <p>{{ producto.descripcion }}</p>
            </div>
            
            {% if producto.especificaciones %}
            <div class="producto-especificaciones">
                <h3>Caracter√≠sticas</h3>
                <ul>
                    {% for espec in producto.especificaciones %}
                    <li>‚ú® {{ espec }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="producto-acciones-detalle">
                <div class="cantidad-selector">
                    <label for="cantidad">Cantidad:</label>
                    <input type="number" id="cantidad" name="cantidad" value="1" min="1" class="cantidad-input">
                </div>
                
                <button class="btn-agregar-carrito-detalle" 
                        data-depto-id="{{ departamento.id }}"
                        data-producto-id="{{ producto.id }}"
                        data-producto-nombre="{{ producto.nombre }}">
                    üõçÔ∏è Agregar al Carrito
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const agregarBtn = document.querySelector('.btn-agregar-carrito-detalle');
    
    agregarBtn.addEventListener('click', function() {
        const deptoId = this.getAttribute('data-depto-id');
        const productoId = this.getAttribute('data-producto-id');
        const productoNombre = this.getAttribute('data-producto-nombre');
        const cantidad = document.getElementById('cantidad').value;
        
        fetch('{{ url_for("agregar_carrito") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'depto_id=' + deptoId + '&producto_id=' + productoId + '&cantidad=' + cantidad
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(cantidad + ' x ' + productoNombre + ' agregado al carrito');
                const cartCount = document.querySelector('.cart-count');
                if (cartCount) {
                    cartCount.textContent = data.carrito_count;
                }
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al agregar al carrito');
        });
    });
});
</script>
{% endblock %}